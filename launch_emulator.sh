#!/bin/bash

# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ° ÑÐ¼ÑƒÐ»ÑÑ‚Ð¾Ñ€Ð° Flutter Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº ÑÐ¼ÑƒÐ»ÑÑ‚Ð¾Ñ€Ð° Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°..."

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÑÐ¾Ð±Ñ€Ð°Ð½Ð¾ Ð»Ð¸ Flutter Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
if [ ! -d "fitness_app/build/web" ]; then
    echo "âš ï¸  Flutter Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð½Ðµ ÑÐ¾Ð±Ñ€Ð°Ð½Ð¾ Ð´Ð»Ñ web"
    echo "ðŸ“¦ Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ..."
    cd fitness_app
    flutter build web
    cd ..
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð»Ð¸ ÑÐµÑ€Ð²ÐµÑ€ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 8001
if ! curl -s http://localhost:8001/fitness_app/build/web/ > /dev/null; then
    echo "ðŸŒ Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ ÑÐµÑ€Ð²ÐµÑ€ Ð´Ð»Ñ Flutter Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 8001..."
    python3 -m http.server 8001 &
    SERVER_PID1=$!
    sleep 2
fi

# Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ ÑÐµÑ€Ð²ÐµÑ€ Ð´Ð»Ñ ÑÐ¼ÑƒÐ»ÑÑ‚Ð¾Ñ€Ð° Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 8003
echo "ðŸ“± Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ ÑÐµÑ€Ð²ÐµÑ€ ÑÐ¼ÑƒÐ»ÑÑ‚Ð¾Ñ€Ð° Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 8003..."
python3 -m http.server 8003 &
SERVER_PID2=$!

sleep 2

echo ""
echo "âœ… Ð“Ð¾Ñ‚Ð¾Ð²Ð¾!"
echo "ðŸ“± Ð­Ð¼ÑƒÐ»ÑÑ‚Ð¾Ñ€ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ: http://localhost:8003/flutter_mobile_frame.html"
echo "ðŸŒ Flutter Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ: http://localhost:8001/fitness_app/build/web/"
echo ""
echo "Ð”Ð»Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð² Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C"

# ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼ ÑÐ¸Ð³Ð½Ð°Ð»Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ
trap 'kill $SERVER_PID1 $SERVER_PID2 2>/dev/null; exit' INT
wait